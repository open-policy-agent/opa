cases:
- modules:
  - |
    package test

    a.b.c.p { true }
  note: 'refheads/complete: direct query'
  query: data.test.a.b.c.p = x
  want_result:
  - x: true
- modules:
  - |
    package test

    a.b.c.p { true }
  note: 'refheads/complete: full package extent'
  query: data.test = x
  want_result:
  - x:
      a:
        b:
          c:
            p: true
- modules:
  - |
    package test

    a.b.c.p = 1
    q = 0
    a.b.d = 3

    p {
      q == 0
      data.test.a.b.c.p == 1
      data.test.a.b.d == 3
    }
  note: refheads/complete+mixed
  query: data.test.p = x
  want_result:
  - x: true
- modules:
  - |
    package test

    a.b[x] { x := numbers.range(1,3)[_] }
  note: refheads/partial set
  query: data.test.a = x
  want_result:
  - x:
      b: [1, 2, 3]
- modules:
  - |
    package test

    a.b[x] = i { x := numbers.range(1,3)[i] }
  note: refheads/partial object
  query: data.test.a = x
  want_result:
  - x:
      b: {"1": 0, "2": 1, "3": 2}
- modules:
  - |
    package test
    a.b.c.d[1] { true }
  - |
    package test.a
    b.c.d[2] { true }
  note: 'refheads/partial set: same rule'
  query: data.test.a = x
  want_result:
  - x:
      b:
        c:
          d: [1, 2]