# NOTE(sr): These tests are not really related to ref heads, but collection
# regressions found when introducing ref heads.
cases:
- note: regression/ref-not-hashable
  modules:
  - |
    package test

    ms[m.z] = m {
      m := input.xs[y]
    }
  input:
    xs:
      something:
        z: a
  query: data.test = x
  want_result:
  - x:
      ms:
        a:
          z: a
- note: regression/function refs and package extent
  modules:
  - |
    package test
    import future.keywords.if

    foo.bar(x) = x+1
    x := foo.bar(2)
  query: data.test = x
  want_result:
  - x:
      foo: {}
      x: 3

- note: regression/rule refs and package extent
  modules:
  - |
    package test
    import future.keywords.if

    buz.quz = 3 if input == 3
    x := y {
      y := buz.quz with input as 3
    }
  query: data.test = x
  want_result:
  - x:
      buz: {}
      x: 3
- note: regression/rule refs and package extents, multiple modules
  modules:
  - |
    package test
    import future.keywords.if

    x := y {
      y := data.test.buz.quz with input as 3
    }
  - |
    package test.buz
    import future.keywords.if

    quz = 3 if input == 3
  query: data.test = x
  want_result:
  - x:
      buz: {}
      x: 3
